<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>KELOMPOK 6 ELKA - Dashboard</title>


<script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-gauges@2"></script>


<style>
body { font-family: Arial; text-align:center; background:#e8eef3; padding:20px; }
.card { background:white; padding:20px; border-radius:15px; box-shadow:0 4px 10px rgba(0,0,0,0.1); }
.container { display:grid; grid-template-columns:repeat(3,1fr); gap:20px; width:90%; margin:auto; }
canvas { background:white; padding:10px; border-radius:10px; }
</style>
</head>
<body>
<h1 style="font-size:32px; font-weight:bold; color:#333; margin-bottom:20px;">KELOMPOK 6 ELKA</h1>


<div class="container">
<canvas id="gaugeTemp"></canvas>
<canvas id="gaugeHumid"></canvas>
<canvas id="gaugePress"></canvas>
</div>


<h2>Sensor History</h2>
<canvas id="chart" width="600" height="300"></canvas>


<script>
// ---------------- MQTT CLIENT ----------------
let client = new Paho.MQTT.Client("wss://test.mosquitto.org:8081/mqtt", "web-client-" + Math.random());


client.onMessageArrived = onMessageArrived;
client.connect({ onSuccess: () => client.subscribe("demo/sensor") });


// ---------------- GAUGES ----------------
let tempGauge = new RadialGauge({ renderTo:"gaugeTemp", width:200, height:200, title:"Temperature", units:"Â°C", minValue:0, maxValue:50 }).draw();
let humidGauge = new RadialGauge({ renderTo:"gaugeHumid", width:200, height:200, title:"Humidity", units:"%", minValue:0, maxValue:100 }).draw();
let pressGauge = new RadialGauge({ renderTo:"gaugePress", width:200, height:200, title:"Pressure", units:"hPa", minValue:900, maxValue:1100 }).draw();


// ---------------- CHART ----------------
let ctx = document.getElementById("chart").getContext("2d");
let chart = new Chart(ctx, {
type: "line",
data: { labels: [], datasets: [
{ label:"Temperature", data:[], borderWidth:2 },
{ label:"Humidity", data:[], borderWidth:2 },
{ label:"Pressure", data:[], borderWidth:2 }
]},
options: { responsive:true, scales:{ y:{ beginAtZero:false }} }
});


// ---------------- UPDATE DISPLAY ----------------
function onMessageArrived(message) {
let data = JSON.parse(message.payloadString);


tempGauge.value = data.temperature;
humidGauge.value = data.humidity;
pressGauge.value = data.pressure;


chart.data.labels.push( new Date().toLocaleTimeString() );
chart.data.datasets[0].data.push(data.temperature);
chart.data.datasets[1].data.push(data.humidity);
chart.data.datasets[2].data.push(data.pressure);


if(chart.data.labels.length > 20) {
chart.data.labels.shift();
chart.data.datasets.forEach(d => d.data.shift());
}


chart.update();
}
</script>
</body>
</html>
